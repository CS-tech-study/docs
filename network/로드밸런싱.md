## 로드 밸런싱
**로드 밸런싱**은 네트워크 또는 서버에 가해지는 부하트래픽을 분산시켜주는 기술

### 필요성
한 대의 서버를 운영하던 과거에 비해 사용자의 요구가 점차 늘어나고 비즈니스 복잡도가 크게 증가하여 서버의 부하가 크게 증가하였음
이에 따라 서버 부하를 줄일 기술이 필요해졌고, 로드 밸런싱은 여러 대의 서버를 두고 서비스를 제공하는 분산 처리 시스템에서 반드시 필요한 기술

![image](https://github.com/user-attachments/assets/208a8fe0-8a52-49e8-bebc-529a8257549f)

### 서버를 확장하는 방법 : Scale up, Scale out
![image](https://github.com/user-attachments/assets/a88508a5-6ba6-418e-b044-633e2899b0ae)

Scale-up : 서버의 자체 사양을 높이는 것, CPU나 RAM 업그레이드
Scale-out : 서버의 개수를 늘리는 것

### 로드 밸런서
클라이언트와 서버 사이의 위치해 서버의 부하를 분산시키는 하드웨어나 소프트웨어

### 로드 밸런서의 종류
L4 로드 밸런서 : HTTP 헤더, 쿠키와 같은 사용자의 요청 정보를 기준으로 특성 서버에 대한 부하를 분산시킴
L7 로드 밸런서 : URL이나 HTTP 헤더의 쿠키 값에 따라 트래픽을 각 서버로 분산 하는 등. 클라이언트의 요청을 보다 세분화하여 서버로 전달

### API Gateway vs 로드 밸런서
API Gateway
- 요청 자체에 관심을 갖는다. 요청의 형식이 올바르고, 올바른 마이크로서비스로 라우팅되며, 리소스 가용성에 따라 우선순위를 지정 또한 인증, 규정 준수 및 기타 확인 프로세스와 같은 작업을 처리하여 요청이 최상의 상태로 제공되도록 한다.

Load Balancer
- 네트워크 트래픽에 더 많은 관심을 갖는다.
- 요청이 제대로 형성되었는지, 어느 MS로 전송되는지가 아닌 요청을 처리할 수 있는 서버가 여유는 있는지 , 네트워크 수요로 인해 과부하가 걸리지는 않는지를 본다.

### API Gateway와 로드 밸런서를 함께 사용할 수 있을까?
> 함께 사용할 수 있다. API Gateway는 요청을 관리하고 적절한 마이크로서비스로 라우팅할 수 있으며,
> Load Balancer는 네트워크 트래픽을 여러 서버에 분산하도록 한다. 이 조합은 효율적인 요청 처리와 부하 분산을 보장 → 보다 강력하고 확장 가능한 시스템을 구축

예시) Api Gateway : Amazon API Gateway, Kong, Zuul / 로드밸런서 : AWS Elastic Load Balancing, Nginx

## 정적 로드 밸런싱
정적 로드 밸런싱 알고리즘은 고정된 규칙을 따르며 현재 서버 상태와 무관합니다.

**라운드 로빈(Round Robin)** 방식은 모든 요청이 순서대로 처리되는 방식입니다. 서버가 3대(A, B, C)가 존재하면 요청은 ABCABC 순서대로 전달됩니다. 모든 서버의 처리 능력이 동등하고, 요청의 고른 분산이 중요한 경우 고려해볼 수 있습니다. 구현이 쉬우며 고른 분산을 보장한다는 것이 장점입니다. 하지만, 서버 부하나 응답 시간을 고려하지 않고 서버의 처리 능력이 다른 경우 비효율적이라는 것이 단점입니다.

**가중치 라운드 로빈(Weighted Round Robin)** 방식은 라운드 로빈 방식에 가중치라는 개념을 추가합니다. 각 서버는 처리 능력과 가용 자원에 따라서 가중치를 할당 받게 됩니다. 그리고, 라운드 로빈 방식을 사용하되 가중치가 높은 서버는 가중치에 비례하여 상대적으로 더욱 많은 요청을 받게 됩니다.

**IP 해시 방식**은 클라이언트 요청의 IP를 기반으로 요청을 전달합니다. IP를 이용해 구한 해시값을 기반으로 요청을 전달할 서버를 결정합니다. IP 해시 방식은 클라이언트와 서버 간의 친화성 유지에 초점을 맞춘 방식으로 클라이언트의 상태에 관리에 용이하다는 장점이 있습니다. 하지만, 상황에 따라서 부하가 균등하게 이루어지지 않는다는 단점이 존재합니다.

![image](https://github.com/user-attachments/assets/8a2c82d0-cd7c-47c5-bff7-30f95000b123)

## 동적 로드 밸런싱
동적 로드 밸런싱 알고리즘은 트래픽을 배포하기 전에 서버의 현재 상태를 검사한다.

**최소 연결(Least Connections) 방식**은 각 서버의 활성 연결 수를 모니터링하고 있는 경우에 사용할 수 있습니다. 가장 적은 활성 연결이 존재하는 서버에게 요청을 전달하는 방식입니다. 각 서버의 처리 능력이 다른 경우에는 적합하지 않을 수 있습니다. 처리 능력이 큰 서버는 상대적으로 활성 연결을 더욱 많이 수립할 수 있기 때문입니다. 최소 연결 방식은 각 서버의 처리 능력이 비슷하지만 특정 이유로 한 서버에 동시 연결 수가 많아 지는 상황이 존재하는 경우 고려해볼 수 있습니다.

로드 밸런싱 대상에 상대적으로 처리 능력이 큰 서버가 존재하는 경우에는 라운드 로빈과 마찬가지로 가중치라는 개념을 사용해볼 수 있습니다. 이를 **가중치 최소 연결**(Weighted Least Connections) 방식이라고 합니다.

**최소 응답 시간(Least Response Time) 방식**은 각 서버의 응답 시간을 모니터링하고 있는 경우에 사용할 수 있습니다. 응답 시간이 가장 빠른 서버에 요청을 전달하는 방식입니다. 서버들마다 응답 시간이 다양할 경우, 가장 빠른 서버에 요청을 전달하여 사용자 경험을 개선하는데 도움이 될 수 있습니다. 응답 시간을 기반으로 하기 때문에 서버의 부하 상태, 활성 연결 수와 같은 다른 요소들을 고려해야하는 경우에는 적합하지 않을 수 있습니다.

**리소스 기반 방법**에서 로드 밸런서는 현재 서버 부하를 분석하여 트래픽을 배포한다. 이는 각각의 서버가 얼마나 바쁜지 (즉, 얼마나 많은 리소스를 사용 중인지) 확인한 후, 가장 여유 있는 상태인 서버로 트래픽을 분배하는 방식이다.

![image](https://github.com/user-attachments/assets/2018b820-6f90-406b-a3c3-67a85367f54e)



<br>

## 참고 자료
- https://aws.amazon.com/ko/what-is/load-balancing/
- https://velog.io/@sh93/%EB%A1%9C%EB%93%9C-%EB%B0%B8%EB%9F%B0%EC%8B%B1Load-balancing
- https://twojun-space.tistory.com/158
- https://velog.io/@dongvelop/AWS-%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%84%9C%EC%99%80-API-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4
